import{O as v,s as q,p as D,P as I}from"./pubsub-54ee595b.js";import{r as f}from"./setup-d58c63dc.js";import{d as y,t as S,f as _,a as o,q as s,g as d,e as L,b as U,h as $}from"./functions-5928807a.js";import{U as E}from"./UcoastEl-dc40e2b2.js";import{t as p}from"./global-4ba5f2af.js";class M extends E{constructor(){super(),this.addEventListener("change",y(t=>{const a=S(t),e=JSON.stringify({note:a.value});fetch(`${f.cart_update_url}`,{..._(),body:e})},v))}}M.htmlSelector="cart-note";class O extends E{constructor(){super(),this.cartUpdateUnsubscriber=void 0,this.lineItemStatusElement=o("#shopping-cart-line-item-status")??s("#CartDrawer-LineItemStatus");const t=y(a=>{this.onChange(a)},v);this.addEventListener("change",t.bind(this))}connectedCallback(){this.cartUpdateUnsubscriber=q(I.cartUpdate,t=>{t&&"source"in t&&t.source==="cart-items"||this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(t){const a=S(t),e=d("data-index",a),n=document.activeElement;if(!n)throw new Error("no document.activeElement");const r=d("name",n);this.updateQuantity(e,a.value,r)}onCartUpdate(){fetch(`${f.cart_url}?section_id=main-cart-items`).then(t=>t.text()).then(t=>{const a=new DOMParser().parseFromString(t,"text/html"),e=s("cart-items",a.documentElement);this.innerHTML=e.innerHTML}).catch(t=>{console.error(t)})}getSectionsToRender(){return[{id:"main-cart-items",section:d("data-id",s("#main-cart-items")),selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:d("data-id",s("#main-cart-footer")),selector:".js-contents"}]}updateQuantity(t,a,e){this.enableLoading(t);const n=JSON.stringify({line:t,quantity:a,sections:this.getSectionsToRender().map(r=>r.section),sections_url:window.location.pathname});fetch(`${f.cart_change_url}`,{..._(),body:n}).then(r=>r.text()).then(r=>{const i=JSON.parse(r),u=o(`#Quantity-${t}`)||s(`#Drawer-quantity-${t}`),x=document.querySelectorAll(".cart-item");if(i.errors){u.value=d("value",u),this.updateLiveRegions(t,i.errors);return}this.classList.toggle("is-empty",i.item_count===0);const c=o("cart-drawer"),b=o("#main-cart-footer");b&&b.classList.toggle("is-empty",i.item_count===0),c&&c.classList.toggle("is-empty",i.item_count===0),this.getSectionsToRender().forEach(m=>{const w=s(`#${m.id}`),T=m.selector&&w.querySelector(m.selector)||w;if(!m.section)throw new Error("no section.section");if(!m.selector)throw new Error("no section.selector");T.innerHTML=this.getSectionInnerHTML(i.sections[m.section],m.selector)});const h=i.items[parseInt(t)-1]?i.items[parseInt(t)-1].quantity:void 0;let g="";x.length===i.items.length&&h!==parseInt(u.value)&&(typeof h>"u"?g=window.cartStrings.error:g=window.cartStrings.quantityError.replace("[quantity]",h)),this.updateLiveRegions(t,g);const l=o(`#CartItem-${t}`)||o(`#CartDrawer-Item-${t}`);l&&l.querySelector(`[name="${e}"]`)?c?p(c,s(`[name="${e}"]`,l)):s(`[name="${e}"]`,l).focus():i.item_count===0&&c?p(s(".drawer__inner-empty",c),s("a",c)):document.querySelector(".cart-item")&&c&&p(c,s(".cart-item__name")),D(I.cartUpdate,{source:"cart-items"})}).catch(()=>{this.querySelectorAll(".loading-overlay").forEach(i=>i.classList.add("hidden"));const r=o("#cart-errors")??s("#CartDrawer-CartErrors");r.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(t)})}updateLiveRegions(t,a){const e=o(`#Line-item-error-${t}`)??o(`#CartDrawer-LineItemError-${t}`);if(e){const r=s(".cart-item__error-text",e);r.innerHTML=a}this.lineItemStatusElement.setAttribute("aria-hidden","true");const n=o("#cart-live-region-text")??s("#CartDrawer-LiveRegionText");n.setAttribute("aria-hidden","false"),setTimeout(()=>{n.setAttribute("aria-hidden","true")},1e3)}getSectionInnerHTML(t,a){const e=new DOMParser().parseFromString(t,"text/html");return s(a,e.documentElement).innerHTML}enableLoading(t){var e,n;this.getMainCartItems().classList.add("cart__items--disabled"),(e=this.getCartItemElements(t))==null||e.forEach(r=>r.classList.remove("hidden")),(n=this.getCartDrawerItemElements(t))==null||n.forEach(r=>r.classList.remove("hidden")),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden","false")}getMainCartItems(){return o("#main-cart-items")??s("#CartDrawer-CartItems")}getCartItemElements(t){return L(`#CartItem-${t} .loading-overlay`,this)}getCartDrawerItemElements(t){return L(`#CartDrawer-Item-${t} .loading-overlay`,this)}disableLoading(t){var e,n;this.getMainCartItems().classList.remove("cart__items--disabled"),(e=this.getCartItemElements(t))==null||e.forEach(r=>r.classList.add("hidden")),(n=this.getCartDrawerItemElements(t))==null||n.forEach(r=>r.classList.add("hidden"))}}O.htmlSelector="cart-items";class R extends E{constructor(){super(),this.addEventListener("click",t=>{t.preventDefault(),(U(this,"cart-items")||$(this,"cart-drawer-items")).updateQuantity(d("data-index",this),"0")})}}R.htmlSelector="cart-remove-button";export{O as C,M as a,R as b};
//# sourceMappingURL=cart-remove-button-b8c3d8b6.js.map
