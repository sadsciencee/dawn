{"version":3,"file":"shopify-d077eff8.js","sources":["../src/scripts/shopify.ts"],"sourcesContent":["import { getAttributeOrThrow, qsRequired } from '@/scripts/functions';\n\nexport interface ShopifyPostLinkOptions extends RequestInit {\n\tparameters?: Record<string, string>\n}\n\nexport class CountryProvinceSelector extends HTMLElement {\n\tcountryEl: HTMLSelectElement\n\tprovinceEl: HTMLSelectElement\n\tprovinceContainer: HTMLElement\n\tconstructor(country_domid:string, province_domid:string, options: {\n\t\thideElement: string\n\t}) {\n\t\tsuper()\n\t\tthis.countryEl = qsRequired(`#${country_domid}`)\n\t\tthis.provinceEl = qsRequired(`#${province_domid}`)\n\t\tthis.provinceContainer = qsRequired(`#${options['hideElement'] || province_domid}`)\n\n\t\tShopify.addListener(this.countryEl, 'change', Shopify.bind(this.countryHandler, this))\n\n\t\tthis.initCountry()\n\t\tthis.initProvince()\n\t}\n\n\tinitCountry() {\n\t\tconst value = getAttributeOrThrow('data-default', this.countryEl)\n\t\tShopify.setSelectorByValue(this.countryEl, value)\n\t\tthis.countryHandler()\n\t}\n\n\tinitProvince() {\n\t\tvar value = this.provinceEl.getAttribute('data-default')\n\t\tif (value && this.provinceEl.options.length > 0) {\n\t\t\tShopify.setSelectorByValue(this.provinceEl, value)\n\t\t}\n\t}\n\n\tcountryHandler() {\n\t\tconst opt = this.countryEl.options[this.countryEl.selectedIndex]\n\t\tconst raw = getAttributeOrThrow('data-provinces', opt)\n\t\tconst provinces = JSON.parse(raw)\n\n\t\tthis.clearOptions(this.provinceEl)\n\t\tif (provinces && provinces.length == 0) {\n\t\t\tthis.provinceContainer.style.display = 'none'\n\t\t} else {\n\t\t\tfor (let i = 0; i < provinces.length; i++) {\n\t\t\t\tconst opt = document.createElement('option')\n\t\t\t\topt.value = provinces[i][0]\n\t\t\t\topt.innerHTML = provinces[i][1]\n\t\t\t\tthis.provinceEl.appendChild(opt)\n\t\t\t}\n\n\t\t\tthis.provinceContainer.style.display = ''\n\t\t}\n\t}\n\n\tclearOptions(selector:HTMLSelectElement) {\n\t\twhile (selector.firstChild) {\n\t\t\tselector.removeChild(selector.firstChild)\n\t\t}\n\t}\n\n\tsetOptions(selector:HTMLSelectElement, values:string[]) {\n\t\tfor (let i = 0, count = values.length; i < count; i++) {\n\t\t\tconst opt = document.createElement('option')\n\t\t\topt.value = values[i]\n\t\t\topt.innerHTML = values[i]\n\t\t\tselector.appendChild(opt)\n\t\t}\n\t}\n}\n\nexport class Shopify {\n\tpublic bind(fn: Function, scope: CountryProvinceSelector) {\n\t\treturn function () {\n\t\t\treturn fn.apply(scope, arguments)\n\t\t}\n\t}\n\tstatic setSelectorByValue(selector: HTMLSelectElement, value: string) {\n\t\tfor (let i = 0, count = selector.options.length; i < count; i++) {\n\t\t\tconst option = selector.options[i]\n\t\t\tif (value == option.value || value == option.innerHTML) {\n\t\t\t\tselector.selectedIndex = i\n\t\t\t\treturn i\n\t\t\t}\n\t\t}\n\t}\n\tstatic addListener(target: EventTarget, eventName: string, callback: EventListenerOrEventListenerObject) {\n\n\t\ttarget.addEventListener\n\t\t\t? target.addEventListener(eventName, callback, false)\n\t\t\t// internet explorer fallback - typescript doesnt know about this\n\t\t\t// TODO: create a custom type for this\n\t\t\t// @ts-ignore\n\t\t\t: target.attachEvent('on' + eventName, callback)\n\t}\n\tstatic postLink(path:string, options:ShopifyPostLinkOptions) {\n\t\toptions = options || {}\n\t\tconst method = options['method'] || 'post'\n\t\tconst params = options['parameters'] || {}\n\n\t\tconst form = document.createElement('form')\n\t\tform.setAttribute('method', method)\n\t\tform.setAttribute('action', path)\n\n\t\tfor (const key in params) {\n\t\t\tconst hiddenField = document.createElement('input')\n\t\t\thiddenField.setAttribute('type', 'hidden')\n\t\t\thiddenField.setAttribute('name', key)\n\t\t\thiddenField.setAttribute('value', params[key])\n\t\t\tform.appendChild(hiddenField)\n\t\t}\n\t\tdocument.body.appendChild(form)\n\t\tform.submit()\n\t\tdocument.body.removeChild(form)\n\t}\n\tstatic CountryProvinceSelector = function (\n\t\tcountry_domid: string,\n\t\tprovince_domid: string,\n\t\toptions: {\n\t\t\thideElement: string\n\t\t}\n\t) {\n\t\treturn new CountryProvinceSelector(country_domid, province_domid, options)\n\t}\n}\n\n/*if (typeof window.Shopify == 'undefined') {\n  window.Shopify = {}\n}*/\n"],"names":["CountryProvinceSelector","country_domid","province_domid","options","qsRequired","Shopify","value","getAttributeOrThrow","opt","raw","provinces","i","selector","values","count","fn","scope","option","target","eventName","callback","path","method","params","form","key","hiddenField"],"mappings":"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"}