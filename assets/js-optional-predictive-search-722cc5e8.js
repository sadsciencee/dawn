import{q as a,i as d,e as m,g as p,s as f}from"./functions-24c9f5aa.js";import{S as g}from"./search-form-ff968a92.js";import{r as v}from"./setup-cc6ab6b9.js";import"./UcoastEl-260a5367.js";import"./shopify-f44b47c1.js";class l extends g{constructor(){super(),this.cachedResults={},this.predictiveSearchResults=a("[data-predictive-search]",this),this.allPredictiveSearchInstances=d("predictive-search"),this.isOpen=!1,this.abortController=new AbortController,this.searchTerm="",this.setupEventListeners()}setupEventListeners(){this.form.addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.addEventListener("keyup",this.onKeyup.bind(this)),this.addEventListener("keydown",this.onKeydown.bind(this))}getQuery(){return this.input.value.trim()}onChange(){var s;super.onChange();const e=this.getQuery();if((!this.searchTerm||!e.startsWith(this.searchTerm))&&((s=this.querySelector("#predictive-search-results-groups-wrapper"))==null||s.remove()),this.updateSearchForTerm(this.searchTerm,e),this.searchTerm=e,!this.searchTerm.length){this.close(!0);return}this.getSearchResults(this.searchTerm)}onFormSubmit(e){(!this.getQuery().length||this.querySelector('[aria-selected="true"] a'))&&e.preventDefault()}onFormReset(e){super.onFormReset(e),super.shouldResetForm()&&(this.searchTerm="",this.abortController.abort(),this.abortController=new AbortController,this.closeResults(!0))}onFocus(){const e=this.getQuery();e.length&&(this.searchTerm!==e?this.onChange():this.getAttribute("results")==="true"?this.open():this.getSearchResults(this.searchTerm))}onFocusOut(){setTimeout(()=>{this.contains(document.activeElement)||this.close()})}onKeyup(e){switch(this.getQuery().length||this.close(!0),e.preventDefault(),e.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption();break}}onKeydown(e){(e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()}updateSearchForTerm(e,s){var r;const t=a("[data-predictive-search-search-for-text]",this),n=t.innerText;if(!n)return;const i=new RegExp(e,"g");if(i===null)return;if(((r=n.match(i))==null?void 0:r.length)??0>1){console.warn("The search term is used more than once in the button text, do not replace to avoid mistakes");return}const h=n.replace(e,s);t.innerText=h}switchOption(e){if(!this.getAttribute("open"))return;const s=e==="up",t=this.querySelector('[aria-selected="true"]'),n=m("li, button.predictive-search__item",this)??[],i=Array.from(n).filter(u=>u.offsetParent!==null);let h=0;if(s&&!t)return;let r=-1,o=0;for(;r===-1&&o<=i.length;)i[o]===t&&(r=o),o++;if(!this.statusElement)throw new Error("switchOption called too early - statusElement not set");if(this.statusElement.textContent="",!s&&t?h=r===i.length-1?0:r+1:s&&(h=r===0?i.length-1:r-1),h===r)return;const c=i[h];c.setAttribute("aria-selected","true"),t&&t.setAttribute("aria-selected","false"),this.input.setAttribute("aria-activedescendant",c.id)}selectOption(){const e=a('[aria-selected="true"] a, button[aria-selected="true"]',this);e&&e.click()}getSearchResults(e){const s=e.replace(" ","-").toLowerCase();if(this.setLiveRegionLoadingState(),this.cachedResults[s]){this.renderSearchResults(this.cachedResults[s]);return}fetch(`${v.predictive_search_url}?q=${encodeURIComponent(e)}&section_id=predictive-search`,{signal:this.abortController.signal}).then(t=>{if(!t.ok){const n=new Error(`${t.status}`);throw this.close(),n}return t.text()}).then(t=>{const n=new DOMParser().parseFromString(t,"text/html"),i=a("#shopify-section-predictive-search",n.documentElement).innerHTML;this.allPredictiveSearchInstances.forEach(h=>{h.cachedResults[s]=i}),this.renderSearchResults(i)}).catch(t=>{if((t==null?void 0:t.code)!==20)throw this.close(),t})}setLiveRegionLoadingState(){this.statusElement=this.statusElement||a(".predictive-search-status",this),this.loadingText=this.loadingText||p("data-loading-text",this),this.setLiveRegionText(this.loadingText),this.setAttribute("loading","true")}setLiveRegionText(e){if(!this.statusElement)throw new Error("setLiveRegionText called to early - this.statusElement is not defined");this.statusElement.setAttribute("aria-hidden","false"),this.statusElement.textContent=e,setTimeout(()=>{if(!this.statusElement)throw new Error("this.statusElement removed before timeout");this.statusElement.setAttribute("aria-hidden","true")},1e3)}renderSearchResults(e){this.predictiveSearchResults.innerHTML=e,this.setAttribute("results","true"),this.setLiveRegionResults(),this.open()}setLiveRegionResults(){this.removeAttribute("loading");const e=a("[data-predictive-search-live-region-count]",this);this.setLiveRegionText((e==null?void 0:e.textContent)??"")}getResultsMaxHeight(){const e=a(".section-header");return this.resultsMaxHeight=window.innerHeight-e.getBoundingClientRect().bottom,this.resultsMaxHeight}open(){this.predictiveSearchResults.style.maxHeight=`${this.resultsMaxHeight}px`||`${this.getResultsMaxHeight()}px`,this.setAttribute("open","true"),this.input.setAttribute("aria-expanded","true"),this.isOpen=!0}close(e=!1){this.closeResults(e),this.isOpen=!1}closeResults(e=!1){e&&(this.input.value="",this.removeAttribute("results"));const s=this.querySelector('[aria-selected="true"]');s&&s.setAttribute("aria-selected","false"),this.input.setAttribute("aria-activedescendant",""),this.removeAttribute("loading"),this.removeAttribute("open"),this.input.setAttribute("aria-expanded","false"),this.resultsMaxHeight=!1,this.predictiveSearchResults.removeAttribute("style")}}l.htmlSelector="predictive-search";f(l);
//# sourceMappingURL=js-optional-predictive-search-722cc5e8.js.map
