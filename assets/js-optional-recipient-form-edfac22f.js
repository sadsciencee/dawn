import{s as a,a as m,P as o,i as f,b}from"./pubsub-54ee595b.js";import{q as s,a as c,g as I,e as E,s as M}from"./functions-de1108d3.js";import{U as F}from"./UcoastEl-5d53ad84.js";class l extends F{constructor(){super(),this.cartUpdateUnsubscriber=void 0,this.variantChangeUnsubscriber=void 0,this.cartErrorUnsubscriber=void 0;const e=this.dataset.sectionId;if(!e)throw new Error("RecipientForm: missing data-section-id");this.sectionId=e,this.recipientFieldsLiveRegion=s(`#Recipient-fields-live-region-${this.sectionId}`,this),this.checkboxInput=s(`#Recipient-checkbox-${this.sectionId}`,this),this.checkboxInput.disabled=!1,this.hiddenControlField=s(`#Recipient-control-${this.sectionId}`,this),this.hiddenControlField.disabled=!0,this.emailInput=s(`#Recipient-email-${this.sectionId}`,this),this.nameInput=s(`#Recipient-name-${this.sectionId}`,this),this.messageInput=s(`#Recipient-message-${this.sectionId}`,this),this.sendonInput=s(`#Recipient-send-on-${this.sectionId}`,this),this.offsetProperty=c(`#Recipient-timezone-offset-${this.sectionId}`,this),this.offsetProperty&&(this.offsetProperty.value=new Date().getTimezoneOffset().toString()),this.errorMessageWrapper=c(".product-form__recipient-error-message-wrapper"),this.errorMessageWrapper instanceof HTMLElement?(this.errorMessageList=s("ul",this.errorMessageWrapper),this.errorMessage=s(".error-message",this.errorMessageWrapper),this.defaultErrorHeader=this.errorMessage.innerText):console.warn("RecipientForm: missing error message wrapper"),this.currentProductVariantId=I("product-variant-id",this),this.addEventListener("change",this.onChange.bind(this)),this.onChange()}connectedCallback(){this.cartUpdateUnsubscriber=a(o.cartUpdate,e=>{var r;m(e)&&e&&e.source==="product-form"&&((r=e.productVariantId)==null?void 0:r.toString())===this.currentProductVariantId&&this.resetRecipientForm()}),this.variantChangeUnsubscriber=a(o.variantChange,e=>{f(e)&&e&&e.data&&e.data.sectionId===this.sectionId&&(this.currentProductVariantId=e.data.variant.id.toString())}),this.cartUpdateUnsubscriber=a(o.cartError,e=>{b(e)&&e.source==="product-form"&&e.productVariantId.toString()===this.currentProductVariantId&&this.displayErrorMessage(e.message,e.errors)})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber(),this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber(),this.cartErrorUnsubscriber&&this.cartErrorUnsubscriber()}onChange(){this.checkboxInput.checked?(this.enableInputFields(),this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormExpanded):(this.clearInputFields(),this.disableInputFields(),this.clearErrorMessage(),this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormCollapsed)}inputFields(){return[this.emailInput,this.nameInput,this.messageInput,this.sendonInput]}disableableFields(){return this.offsetProperty?[...this.inputFields(),this.offsetProperty]:this.inputFields()}clearInputFields(){this.inputFields().forEach(e=>e.value="")}enableInputFields(){this.disableableFields().forEach(e=>e.disabled=!1)}disableInputFields(){this.disableableFields().forEach(e=>e.disabled=!0)}displayErrorMessage(e,r){if(this.clearErrorMessage(),!this.errorMessageWrapper)throw new Error("RecipientForm: displayErrorMessage called too early, missing error message wrapper");if(this.errorMessageWrapper.hidden=!1,typeof r=="object"){if(!(this.errorMessage instanceof HTMLElement))throw new Error("RecipientForm: displayErrorMessage called too early, missing error message");return this.errorMessage.innerText=this.defaultErrorHeader??"Error",Object.entries(r).forEach(([t,i])=>{const h=`RecipientForm-${t}-error-${this.sectionId}`,u=`#Recipient-${t}-${this.sectionId}`,d=`${i.join(", ")}`,p=s(`#${h}`,this),g=s(".error-message",p);this.errorMessageList&&this.errorMessageList.appendChild(this.createErrorListItem(u,d)),g.innerText=`${d}.`,p.classList.remove("hidden");const n=this.getInputElement(t);n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",h))})}if(!(this.errorMessage instanceof HTMLElement))throw new Error("Missing this.errorMessage, cannot display error");this.errorMessage.innerText=r}getInputElement(e){switch(e){case"email":return this.emailInput;case"name":return this.nameInput;case"message":return this.messageInput;case"sendon":return this.sendonInput;case"checkbox":return this.checkboxInput}throw new Error(`RecipientForm: unknown input element ${e}`)}createErrorListItem(e,r){const t=document.createElement("li"),i=document.createElement("a");return i.setAttribute("href",e),i.innerText=r,t.appendChild(i),t.className="error-message",t}clearErrorMessage(){if(!this.errorMessageWrapper)throw new Error("Missing this.errorMessageWrapper, cannot clearErrorMessage");this.errorMessageWrapper.hidden=!0,this.errorMessageList&&(this.errorMessageList.innerHTML="");const e=E(".recipient-fields .form__message",this);e&&e.forEach(r=>{r.classList.add("hidden");const t=c(".error-message",r);t&&(t.innerText="")}),[this.emailInput,this.messageInput,this.nameInput,this.sendonInput].forEach(r=>{r.setAttribute("aria-invalid","false"),r.removeAttribute("aria-describedby")})}resetRecipientForm(){this.checkboxInput.checked&&(this.checkboxInput.checked=!1,this.clearInputFields(),this.clearErrorMessage())}}l.htmlSelector="recipient-form";M(l);
//# sourceMappingURL=js-optional-recipient-form-edfac22f.js.map
