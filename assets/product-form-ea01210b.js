import{p as d,P as c}from"./pubsub-54ee595b.js";import{q as r,a as u,v as m,b as l}from"./functions-de1108d3.js";import{r as h}from"./setup-240a0a56.js";import{U as f}from"./UcoastEl-5d53ad84.js";class p extends f{constructor(){super(),this.form=r("form",this),this.formIdEl=r("[name=id]",this.form),this.formIdEl.disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=u("cart-notification")||u("cart-drawer"),this.submitButton=r('[type="submit"]',this),this.cart&&this.cart.localName==="cart-drawer"&&this.submitButton.setAttribute("aria-haspopup","dialog"),this.hideErrors=this.dataset.hideErrors==="true"}getSpinner(){return r(".loading-overlay__spinner",this)}onSubmitHandler(s){if(s.preventDefault(),this.submitButton.getAttribute("aria-disabled")==="true")return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled","true"),this.submitButton.classList.add("loading"),this.getSpinner().classList.remove("hidden");const i=new FormData(this.form);if(console.log("this.form",this.form),console.log({formData:JSON.stringify(i)}),this.cart){const t=this.cart.getSectionsToRender().filter(e=>e.id).map(e=>e.id);if(!t.length)throw Error("getSectionsToRender returned empty array");if(i.append("sections",t.join(",")),i.append("sections_url",window.location.pathname),!(document.activeElement instanceof HTMLElement))throw Error("no activeElement");this.cart.setActiveElement(document.activeElement)}const a=m(i),o=i.get("id");if(console.log({config:a,url:`${h.cart_add_url}`}),!o)throw Error("No variant id found");fetch(`${h.cart_add_url}`,a).then(t=>t.json()).then(t=>{if(t.status){d(c.cartError,{source:"product-form",productVariantId:o,errors:t.errors||t.description,message:t.message}),this.handleErrorMessage(t.description);const n=this.submitButton.querySelector(".sold-out-message");if(!n)return;this.submitButton.setAttribute("aria-disabled","true"),r("span",this.submitButton).classList.add("hidden"),n.classList.remove("hidden"),this.error=!0;return}else if(!this.cart){window.location=window.routes.cart_url;return}this.error||d(c.cartUpdate,{source:"product-form",productVariantId:o}),this.error=!1;const e=l(this,"quick-add-modal");e?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cart&&this.cart.renderContents(t)})},{once:!0}),e.hide(!0)):this.cart.renderContents(t)}).catch(t=>{console.error(t)}).finally(()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.submitButton.removeAttribute("aria-disabled"),this.getSpinner().classList.add("hidden")})}handleErrorMessage(s){if(!this.hideErrors){if(this.errorMessageWrapper=this.errorMessageWrapper||r(".product-form__error-message-wrapper",this),!this.errorMessageWrapper)throw new Error("No error message wrapper found");this.errorMessage=this.errorMessage||r(".product-form__error-message",this.errorMessageWrapper),this.errorMessageWrapper.toggleAttribute("hidden",!s),s&&(this.errorMessage.textContent=s)}}}p.htmlSelector="product-form";export{p as P};
//# sourceMappingURL=product-form-ea01210b.js.map
