import{p as n,P as d}from"./pubsub-54ee595b.js";import{q as r,a as u,v as h,b as m}from"./functions-24c9f5aa.js";import{r as l}from"./setup-cc6ab6b9.js";import{U as p}from"./UcoastEl-260a5367.js";class f extends p{constructor(){super(),this.form=r("form",this),this.formIdEl=r("[name=id]",this.form),this.formIdEl.disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=u("cart-notification")||u("cart-drawer"),this.submitButton=r('[type="submit"]',this),this.cart&&this.cart.localName==="cart-drawer"&&this.submitButton.setAttribute("aria-haspopup","dialog"),this.hideErrors=this.dataset.hideErrors==="true"}getSpinner(){return r(".loading-overlay__spinner",this)}onSubmitHandler(s){if(s.preventDefault(),this.submitButton.getAttribute("aria-disabled")==="true")return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled","true"),this.submitButton.classList.add("loading"),this.getSpinner().classList.remove("hidden");const i=new FormData(this.form);if(this.cart){const t=this.cart.getSectionsToRender().filter(e=>e.id).map(e=>e.id);if(!t.length)throw Error("getSectionsToRender returned empty array");if(i.append("sections",t.join(",")),i.append("sections_url",window.location.pathname),!(document.activeElement instanceof HTMLElement))throw Error("no activeElement");this.cart.setActiveElement(document.activeElement)}const c=h(i),o=i.get("id");if(!o)throw Error("No variant id found");fetch(`${l.cart_add_url}`,c).then(t=>t.json()).then(t=>{if(t.status){n(d.cartError,{source:"product-form",productVariantId:o,errors:t.errors||t.description,message:t.message}),this.handleErrorMessage(t.description);const a=this.submitButton.querySelector(".sold-out-message");if(!a)return;this.submitButton.setAttribute("aria-disabled","true"),r("span",this.submitButton).classList.add("hidden"),a.classList.remove("hidden"),this.error=!0;return}else if(!this.cart){window.location=window.routes.cart_url;return}this.error||n(d.cartUpdate,{source:"product-form",productVariantId:o}),this.error=!1;const e=m(this,"quick-add-modal");e?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cart&&this.cart.renderContents(t)})},{once:!0}),e.hide(!0)):this.cart.renderContents(t)}).catch(t=>{console.error(t)}).finally(()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.submitButton.removeAttribute("aria-disabled"),this.getSpinner().classList.add("hidden")})}handleErrorMessage(s){if(!this.hideErrors){if(this.errorMessageWrapper=this.errorMessageWrapper||r(".product-form__error-message-wrapper",this),!this.errorMessageWrapper)throw new Error("No error message wrapper found");this.errorMessage=this.errorMessage||r(".product-form__error-message",this.errorMessageWrapper),this.errorMessageWrapper.toggleAttribute("hidden",!s),s&&(this.errorMessage.textContent=s)}}}f.htmlSelector="product-form";export{f as P};
//# sourceMappingURL=product-form-32ca35ea.js.map
