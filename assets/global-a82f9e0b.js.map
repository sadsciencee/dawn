{"version":3,"file":"global-a82f9e0b.js","sources":["../src/scripts/theme/global.ts"],"sourcesContent":["import {\n\tfocusVisiblePolyfill,\n\tgetFocusableElements,\n\tinitializeSummaryA11y,\n\ttargetRequired,\n} from '@/scripts/functions'\n\nimport { type FocusableHTMLElement } from '@/scripts/types/theme'\n\n// this is a default shopify function that normally runs in global scope\n// I moved it to functions for clarity\ninitializeSummaryA11y()\n\n// trapFocusHandlers variable and associated functions are part of the global scope\n// this function should always run first\n\nconst trapFocusHandlers: {\n\tfocusin?: (event: Event) => void\n\tfocusout?: (event: Event) => void\n\tkeydown?: (event: KeyboardEvent) => void\n} = {}\n\nexport function trapFocus(container: HTMLElement, elementToFocus: HTMLElement | undefined = container) {\n\tconst elements = getFocusableElements(container)\n\tconst first = elements[0]\n\tconst last = elements[elements.length - 1]\n\n\tremoveTrapFocus()\n\n\ttrapFocusHandlers.focusin = (event) => {\n\t\tif (event.target !== container && event.target !== last && event.target !== first) return\n\n\t\tif (!trapFocusHandlers.keydown)\n\t\t\tthrow new Error('trapFocusHandlers.focusin called before .keydown is defined')\n\n\t\tdocument.addEventListener('keydown', trapFocusHandlers.keydown)\n\t}\n\n\ttrapFocusHandlers.focusout = function () {\n\t\tif (!trapFocusHandlers.keydown)\n\t\t\tthrow new Error('trapFocusHandlers.focusout called before .keydown is defined')\n\t\tdocument.removeEventListener('keydown', trapFocusHandlers.keydown)\n\t}\n\n\ttrapFocusHandlers.keydown = function (event: KeyboardEvent) {\n\t\tif (event.code.toUpperCase() !== 'TAB') return // If not TAB key\n\t\t// On the last focusable element and tab forward, focus the first element.\n\t\tconst target = targetRequired<KeyboardEvent, FocusableHTMLElement>(event)\n\t\tif (target === last && !event.shiftKey) {\n\t\t\tevent.preventDefault()\n\t\t\tfirst.focus()\n\t\t}\n\n\t\t//  On the first focusable element and tab backward, focus the last element.\n\t\tif ((event.target === container || event.target === first) && event.shiftKey) {\n\t\t\tevent.preventDefault()\n\t\t\tlast.focus()\n\t\t}\n\t}\n\n\tdocument.addEventListener('focusout', trapFocusHandlers.focusout)\n\tdocument.addEventListener('focusin', trapFocusHandlers.focusin)\n\n\telementToFocus.focus()\n\n\tif (\n\t\telementToFocus instanceof HTMLInputElement &&\n\t\t['search', 'text', 'email', 'url'].includes(elementToFocus.type) &&\n\t\telementToFocus.value\n\t) {\n\t\telementToFocus.setSelectionRange(0, elementToFocus.value.length)\n\t}\n}\n\n// Here run the querySelector to figure out if the browser supports :focus-visible or not and run code based on it.\ntry {\n\tdocument.querySelector(':focus-visible')\n} catch (e) {\n\tfocusVisiblePolyfill()\n}\n\n// don't know why shopify put this function below the above but I'm not about to go debug it\n\nexport function removeTrapFocus(elementToFocus: HTMLElement | undefined = undefined) {\n\tif (trapFocusHandlers.focusin) {\n\t\tdocument.removeEventListener('focusin', trapFocusHandlers.focusin)\n\t}\n\tif (trapFocusHandlers.focusout) {\n\t\tdocument.removeEventListener('focusout', trapFocusHandlers.focusout)\n\t}\n\n\tif (trapFocusHandlers.keydown) {\n\t\tdocument.removeEventListener('keydown', trapFocusHandlers.keydown)\n\t}\n\n\tif (elementToFocus) elementToFocus.focus()\n}\n"],"names":["initializeSummaryA11y","trapFocusHandlers","trapFocus","container","elementToFocus","elements","getFocusableElements","first","last","removeTrapFocus","event","targetRequired","focusVisiblePolyfill"],"mappings":"iEAWAA,IAKA,MAAMC,EAIF,CAAA,EAEY,SAAAC,EAAUC,EAAwBC,EAA0CD,EAAW,CAChG,MAAAE,EAAWC,EAAqBH,CAAS,EACzCI,EAAQF,EAAS,CAAC,EAClBG,EAAOH,EAASA,EAAS,OAAS,CAAC,EAEzBI,IAEER,EAAA,QAAWS,GAAU,CACtC,GAAI,EAAAA,EAAM,SAAWP,GAAaO,EAAM,SAAWF,GAAQE,EAAM,SAAWH,GAE5E,IAAI,CAACN,EAAkB,QAChB,MAAA,IAAI,MAAM,6DAA6D,EAErE,SAAA,iBAAiB,UAAWA,EAAkB,OAAO,EAAA,EAG/DA,EAAkB,SAAW,UAAY,CACxC,GAAI,CAACA,EAAkB,QAChB,MAAA,IAAI,MAAM,8DAA8D,EACtE,SAAA,oBAAoB,UAAWA,EAAkB,OAAO,CAAA,EAGhDA,EAAA,QAAU,SAAUS,EAAsB,CACvD,GAAAA,EAAM,KAAK,YAAA,IAAkB,MAAO,OAEzBC,EAAoDD,CAAK,IACzDF,GAAQ,CAACE,EAAM,WAC7BA,EAAM,eAAe,EACrBH,EAAM,MAAM,IAIRG,EAAM,SAAWP,GAAaO,EAAM,SAAWH,IAAUG,EAAM,WACnEA,EAAM,eAAe,EACrBF,EAAK,MAAM,EACZ,EAGQ,SAAA,iBAAiB,WAAYP,EAAkB,QAAQ,EACvD,SAAA,iBAAiB,UAAWA,EAAkB,OAAO,EAE9DG,EAAe,MAAM,EAGpBA,aAA0B,kBAC1B,CAAC,SAAU,OAAQ,QAAS,KAAK,EAAE,SAASA,EAAe,IAAI,GAC/DA,EAAe,OAEfA,EAAe,kBAAkB,EAAGA,EAAe,MAAM,MAAM,CAEjE,CAGA,GAAI,CACH,SAAS,cAAc,gBAAgB,CACxC,MAAA,CACsBQ,GACtB,CAIgB,SAAAH,EAAgBL,EAA0C,OAAW,CAChFH,EAAkB,SACZ,SAAA,oBAAoB,UAAWA,EAAkB,OAAO,EAE9DA,EAAkB,UACZ,SAAA,oBAAoB,WAAYA,EAAkB,QAAQ,EAGhEA,EAAkB,SACZ,SAAA,oBAAoB,UAAWA,EAAkB,OAAO,EAG9DG,GAAgBA,EAAe,MAAM,CAC1C"}