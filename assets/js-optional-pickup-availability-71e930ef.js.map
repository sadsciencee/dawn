{"version":3,"file":"js-optional-pickup-availability-71e930ef.js","sources":["../src/scripts/optional/pickup-availability.ts","../src/scripts/optional/pickup-availability-drawer.ts","../src/entry/js-optional-pickup-availability.ts"],"sourcesContent":["import { getAttributeOrThrow, qsOptional, qsRequired, targetRequired } from '@/scripts/functions'\nimport { type PickupAvailabilityDrawer } from '@/scripts/optional/pickup-availability-drawer'\nimport { UcoastEl } from '@/scripts/core/UcoastEl'\n\nexport class PickupAvailability extends UcoastEl {\n\tstatic htmlSelector = 'pickup-availability'\n\terrorHtml?: Node | null\n\tconstructor() {\n\t\tsuper()\n\n\t\tif (!this.hasAttribute('available')) return\n\t\tconst template = qsRequired<HTMLTemplateElement>('template', this)\n\t\tconst content = template.content\n\t\tconst firstElementChild = content.firstElementChild\n\t\tif (!content || !firstElementChild || firstElementChild === null) {\n\t\t\tconsole.error('No template content found in PickupAvailability')\n\t\t}\n\n\t\tthis.errorHtml = firstElementChild?.cloneNode(true)\n\t\tthis.onClickRefreshList = this.onClickRefreshList.bind(this)\n\t\tconst variantId = getAttributeOrThrow('variant-id', this)\n\t\tthis.fetchAvailability(variantId)\n\t}\n\n\tfetchAvailability(variantId: string) {\n\t\tlet rootUrl = this.dataset.rootUrl\n\t\tif (!rootUrl) {\n\t\t\trootUrl = window.location.origin\n\t\t}\n\t\tif (!rootUrl.endsWith('/')) {\n\t\t\trootUrl = rootUrl + '/'\n\t\t}\n\t\tconst variantSectionUrl = `${rootUrl}variants/${variantId}/?section_id=pickup-availability`\n\n\t\tfetch(variantSectionUrl)\n\t\t\t.then((response) => response.text())\n\t\t\t.then((text) => {\n\t\t\t\tconst sectionInnerHTML = new DOMParser()\n\t\t\t\t\t.parseFromString(text, 'text/html')\n\t\t\t\t\t.querySelector('.shopify-section')\n\t\t\t\tif (sectionInnerHTML instanceof Document) {\n\t\t\t\t\tthis.renderPreview(sectionInnerHTML)\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'No shopify-section found in sectionInnerHTML or was not instance of document'\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error)\n\t\t\t\tconst button = this.querySelector('button')\n\t\t\t\tif (button) button.removeEventListener('click', this.onClickRefreshList)\n\t\t\t\tthis.renderError()\n\t\t\t})\n\t}\n\n\tonClickRefreshList(_event: Event) {\n\t\tconst variantId = getAttributeOrThrow('variant-id', this)\n\t\tthis.fetchAvailability(variantId)\n\t}\n\n\trenderError() {\n\t\tthis.innerHTML = ''\n\t\tif (!this.errorHtml) throw new Error('renderError thrown too early')\n\t\tthis.appendChild(this.errorHtml)\n\n\t\tconst button = qsRequired('button', this)\n\t\tbutton.addEventListener('click', this.onClickRefreshList)\n\t}\n\n\trenderPreview(sectionInnerHTML: Document) {\n\t\tconst drawer = qsOptional<PickupAvailabilityDrawer>('pickup-availability-drawer')\n\t\tif (drawer) drawer.remove()\n\t\tconst pickupAvailabilityPreview = qsOptional(\n\t\t\t'pickup-availability-preview',\n\t\t\tsectionInnerHTML\n\t\t)\n\t\tif (!pickupAvailabilityPreview) {\n\t\t\tthis.innerHTML = ''\n\t\t\tthis.removeAttribute('available')\n\t\t\treturn\n\t\t}\n\n\t\tthis.innerHTML = pickupAvailabilityPreview.outerHTML\n\t\tthis.setAttribute('available', '')\n\t\tconst drawerNode = sectionInnerHTML.querySelector('pickup-availability-drawer')\n\n\t\tif (drawerNode instanceof Node) {\n\t\t\tdocument.body.appendChild(drawerNode)\n\t\t} else {\n\t\t\tthrow new Error('No pickup-availability-drawer found in sectionInnerHTML')\n\t\t}\n\n\t\tconst button = this.querySelector('button')\n\t\tif (button)\n\t\t\tbutton.addEventListener('click', (event: MouseEvent) => {\n\t\t\t\tconst drawer = qsRequired<PickupAvailabilityDrawer>('pickup-availability-drawer')\n\t\t\t\tconst target = targetRequired(event)\n\t\t\t\tdrawer.show(target)\n\t\t\t})\n\t}\n}\n","import { qsRequired, targetRequired } from '@/scripts/functions'\nimport { removeTrapFocus, trapFocus } from '@/scripts/theme/global'\nimport { UcoastEl } from '@/scripts/core/UcoastEl'\n\nexport class PickupAvailabilityDrawer extends UcoastEl {\n\tstatic htmlSelector = 'pickup-availability-drawer'\n\tonBodyClick: (event: MouseEvent) => void\n\topener: HTMLButtonElement\n\tfocusElement?: HTMLElement\n\tconstructor() {\n\t\tsuper()\n\n\t\tthis.onBodyClick = this.handleBodyClick.bind(this)\n\t\tthis.opener = qsRequired('button', this)\n\n\t\tthis.opener.addEventListener('click', () => {\n\t\t\tthis.hide()\n\t\t})\n\n\t\tthis.addEventListener('keyup', (event) => {\n\t\t\tif (event.code.toUpperCase() === 'ESCAPE') this.hide()\n\t\t})\n\t}\n\n\thandleBodyClick(event: MouseEvent) {\n\t\tconst target = targetRequired(event)\n\t\tif (\n\t\t\ttarget != this &&\n\t\t\t!target.closest('pickup-availability-drawer') &&\n\t\t\ttarget.id != 'ShowPickupAvailabilityDrawer'\n\t\t) {\n\t\t\tthis.hide()\n\t\t}\n\t}\n\n\thide() {\n\t\tthis.removeAttribute('open')\n\t\tdocument.body.removeEventListener('click', this.onBodyClick)\n\t\tdocument.body.classList.remove('overflow-hidden')\n\t\tremoveTrapFocus(this.focusElement)\n\t}\n\n\tshow(focusElement: HTMLElement) {\n\t\tthis.focusElement = focusElement\n\t\tthis.setAttribute('open', '')\n\t\tdocument.body.addEventListener('click', this.onBodyClick)\n\t\tdocument.body.classList.add('overflow-hidden')\n\t\ttrapFocus(this)\n\t}\n}\n","import { PickupAvailability } from '@/scripts/optional/pickup-availability'\nimport { PickupAvailabilityDrawer } from '@/scripts/optional/pickup-availability-drawer'\nimport { safeDefineElement } from '@/scripts/functions'\nsafeDefineElement(PickupAvailabilityDrawer)\nsafeDefineElement(PickupAvailability)\n\n"],"names":["PickupAvailability","UcoastEl","content","qsRequired","firstElementChild","variantId","getAttributeOrThrow","rootUrl","variantSectionUrl","response","text","sectionInnerHTML","error","button","_event","drawer","qsOptional","pickupAvailabilityPreview","drawerNode","event","target","targetRequired","PickupAvailabilityDrawer","removeTrapFocus","focusElement","trapFocus","safeDefineElement"],"mappings":"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"}