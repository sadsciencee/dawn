{"version":3,"file":"js-dir-cart-drawer-8f7f8b38.js","sources":["../src/scripts/cart-drawer/cart-drawer.ts","../src/scripts/cart-drawer/cart-drawer-items.ts","../src/entry/js-dir-cart-drawer.ts"],"sourcesContent":["import { ShopifySectionRenderingSchema } from '@/scripts/types/theme'\nimport { SectionApiResponse } from '@/scripts/types/responses'\nimport {\n\tclosestOptional,\n\tcurrentTargetRequired,\n\tonKeyUpEscape,\n\tqsOptional,\n\tqsRequired,\n} from '@/scripts/functions'\nimport { removeTrapFocus, trapFocus } from '@/scripts/theme/global'\nimport { UcoastEl } from '@/scripts/core/UcoastEl'\n\nexport class CartDrawer extends UcoastEl {\n\tstatic htmlSelector = 'cart-drawer'\n\tactiveElement?: HTMLElement\n\tproductId?: string\n\tconstructor() {\n\t\tsuper()\n\n\t\tthis.addEventListener('keyup', (evt) => evt.code === 'Escape' && this.close())\n\t\tthis.getOverlay().addEventListener('click', this.close.bind(this))\n\t\tthis.setHeaderCartIconAccessibility()\n\t}\n\n\tgetOverlay() {\n\t\treturn qsRequired('#CartDrawer-Overlay', this)\n\t}\n\n\tsetHeaderCartIconAccessibility() {\n\t\tconst cartLink = qsRequired('#cart-icon-bubble')\n\t\tcartLink.setAttribute('role', 'button')\n\t\tcartLink.setAttribute('aria-haspopup', 'dialog')\n\t\tcartLink.addEventListener('click', (event) => {\n\t\t\tevent.preventDefault()\n\t\t\tthis.open(cartLink)\n\t\t})\n\t\tcartLink.addEventListener('keydown', (event) => {\n\t\t\tif (event.code.toUpperCase() === 'SPACE') {\n\t\t\t\tevent.preventDefault()\n\t\t\t\tthis.open(cartLink)\n\t\t\t}\n\t\t})\n\t}\n\n\topen(triggeredBy?: HTMLElement) {\n\t\tif (triggeredBy) this.setActiveElement(triggeredBy)\n\t\tconst cartDrawerNote = qsOptional('[id^=\"Details-\"] summary', this)\n\t\tif (cartDrawerNote && !cartDrawerNote.hasAttribute('role'))\n\t\t\tthis.setSummaryAccessibility(cartDrawerNote)\n\t\t// here the animation doesn't seem to always get triggered. A timeout seem to help\n\t\tsetTimeout(() => {\n\t\t\tthis.classList.add('animate', 'active')\n\t\t}, 1)\n\n\t\tthis.addEventListener(\n\t\t\t'transitionend',\n\t\t\t() => {\n\t\t\t\tconst containerToTrapFocusOn = this.classList.contains('is-empty')\n\t\t\t\t\t? qsRequired('.drawer__inner-empty', this)\n\t\t\t\t\t: qsRequired('#CartDrawer')\n\t\t\t\tconst focusElement =\n\t\t\t\t\tqsOptional('.drawer__inner', this) || qsRequired('.drawer__close', this)\n\t\t\t\ttrapFocus(containerToTrapFocusOn, focusElement)\n\t\t\t},\n\t\t\t{ once: true }\n\t\t)\n\n\t\tdocument.body.classList.add('overflow-hidden')\n\t}\n\n\tclose() {\n\t\tthis.classList.remove('active')\n\t\tremoveTrapFocus(this.activeElement)\n\t\tdocument.body.classList.remove('overflow-hidden')\n\t}\n\n\tsetSummaryAccessibility(cartDrawerNote: HTMLElement) {\n\t\tconst parentElement = cartDrawerNote.parentElement\n\t\tif (!parentElement)\n\t\t\tthrow new Error('setSummaryAccessibility failed - No parent element found')\n\t\tcartDrawerNote.setAttribute('role', 'button')\n\t\tcartDrawerNote.setAttribute('aria-expanded', 'false')\n\t\tconst nextElementSibling = cartDrawerNote.nextElementSibling\n\n\t\tif (nextElementSibling instanceof HTMLElement && nextElementSibling.hasAttribute('id')) {\n\t\t\tcartDrawerNote.setAttribute('aria-controls', nextElementSibling.id)\n\t\t}\n\n\t\tcartDrawerNote.addEventListener('click', (event: MouseEvent) => {\n\t\t\tconst currentTarget = currentTargetRequired(event)\n\t\t\tconst closestDetails = closestOptional(currentTarget, 'details')\n\t\t\tcurrentTarget.setAttribute('aria-expanded', `${!closestDetails?.hasAttribute('open')}`)\n\t\t})\n\n\t\tparentElement.addEventListener('keyup', onKeyUpEscape)\n\t}\n\n\trenderContents(parsedState: SectionApiResponse) {\n\t\tqsRequired('.drawer__inner', this).classList.contains('is-empty') &&\n\t\t\tqsRequired('.drawer__inner', this).classList.remove('is-empty')\n\t\tthis.productId = parsedState.id\n\t\tthis.getSectionsToRender().forEach((section) => {\n\t\t\tconst sectionId = section.id\n\t\t\tif (!sectionId) throw new Error('Section id is required')\n\t\t\tconst sectionElement = section.selector\n\t\t\t\t? qsRequired(section.selector)\n\t\t\t\t: qsRequired(`#${sectionId}`)\n\t\t\tsectionElement.innerHTML = this.getSectionInnerHTML(\n\t\t\t\tparsedState.sections[sectionId],\n\t\t\t\tsection.selector\n\t\t\t)\n\t\t})\n\n\t\tsetTimeout(() => {\n\t\t\tthis.getOverlay().addEventListener('click', this.close.bind(this))\n\t\t\tthis.open()\n\t\t})\n\t}\n\n\tgetSectionInnerHTML(html: string, selector = '.shopify-section') {\n\t\tconst newDocument = new DOMParser().parseFromString(html, 'text/html')\n\t\treturn qsRequired(selector, newDocument.documentElement).innerHTML\n\t}\n\n\tgetSectionsToRender(): ShopifySectionRenderingSchema[] {\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'cart-drawer',\n\t\t\t\tselector: '#CartDrawer',\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'cart-icon-bubble',\n\t\t\t},\n\t\t]\n\t}\n\n\tgetSectionDOM(html: string, selector = '.shopify-section') {\n\t\treturn new DOMParser().parseFromString(html, 'text/html').querySelector(selector)\n\t}\n\n\tsetActiveElement(element: HTMLElement) {\n\t\tthis.activeElement = element\n\t}\n}\n","import { CartItems } from '@/scripts/cart-page/cart-items'\n\nexport class CartDrawerItems extends CartItems {\n\tstatic override htmlSelector = 'cart-drawer-items'\n\toverride getSectionsToRender() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'CartDrawer',\n\t\t\t\tsection: 'cart-drawer',\n\t\t\t\tselector: '.drawer__inner',\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'cart-icon-bubble',\n\t\t\t\tsection: 'cart-icon-bubble',\n\t\t\t\tselector: '.shopify-section',\n\t\t\t},\n\t\t]\n\t}\n}\n","import { safeDefineElement } from '@/scripts/functions';\nimport { CartDrawer } from '@/scripts/cart-drawer/cart-drawer'\nimport { CartNote } from '@/scripts/cart-page/cart-note'\nimport { CartDrawerItems } from '@/scripts/cart-drawer/cart-drawer-items'\nimport { CartRemoveButton } from '@/scripts/cart-page/cart-remove-button'\n\nsafeDefineElement(CartDrawer)\nsafeDefineElement(CartNote)\nsafeDefineElement(CartDrawerItems)\nsafeDefineElement(CartRemoveButton)\n\n\n"],"names":["CartDrawer","UcoastEl","evt","qsRequired","cartLink","event","triggeredBy","cartDrawerNote","qsOptional","containerToTrapFocusOn","focusElement","trapFocus","removeTrapFocus","parentElement","nextElementSibling","currentTarget","currentTargetRequired","closestDetails","closestOptional","onKeyUpEscape","parsedState","section","sectionId","sectionElement","html","selector","newDocument","element","CartDrawerItems","CartItems","safeDefineElement","CartNote","CartRemoveButton"],"mappings":"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"}