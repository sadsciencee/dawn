{"version":3,"file":"js-optional-quick-add-6cfb97a0.js","sources":["../src/scripts/optional/quick-add.ts","../src/entry/js-optional-quick-add.ts"],"sourcesContent":["import { ModalDialog } from '@/scripts/theme/modal-dialog'\nimport {\n\tgetAttributeOrThrow,\n\tqsaOptional,\n\tqsOptional,\n\tqsRequired,\n\treplaceAll,\n} from '@/scripts/functions'\nimport { type CartNotification } from '@/scripts/theme/cart-notification'\nimport { type uCoastWindow } from '@/scripts/setup'\nimport { type CartDrawer } from '@/scripts/cart-drawer/cart-drawer'\nimport { type PickupAvailability } from '@/scripts/optional/pickup-availability'\nimport { type ProductModal } from '@/scripts/product/product-modal'\nimport { type VariantSelects } from '@/scripts/theme/variant-selects'\nimport { type VariantRadios } from '@/scripts/theme/variant-radios'\nimport { type ProductInfo } from '@/scripts/product/product-info'\n\ndeclare let window: uCoastWindow\n\nexport class QuickAddModal extends ModalDialog {\n\tstatic override htmlSelector = 'quick-add-modal'\n\tproductElement?: HTMLElement\n\tmodalContent: HTMLElement\n\tconstructor() {\n\t\tsuper()\n\t\tthis.modalContent = qsRequired('[id^=\"QuickAddInfo-\"]', this)\n\t}\n\n\toverride hide(preventFocus = false) {\n\t\tconst cartNotification =\n\t\t\tqsOptional<CartNotification>('cart-notification') ||\n\t\t\tqsRequired<CartDrawer>('cart-drawer')\n\t\tif (cartNotification && this.openedBy) cartNotification.setActiveElement(this.openedBy)\n\t\tthis.modalContent.innerHTML = ''\n\n\t\tif (preventFocus) this.openedBy = undefined\n\t\tsuper.hide()\n\t}\n\n\toverride show(opener: HTMLElement) {\n\t\topener.setAttribute('aria-disabled', 'true')\n\t\topener.classList.add('loading')\n\t\tqsRequired('.loading-overlay__spinner', opener).classList.remove('hidden')\n\n\t\tfetch(getAttributeOrThrow('data-product-url', opener))\n\t\t\t.then((response) => response.text())\n\t\t\t.then((responseText) => {\n\t\t\t\tconst responseHTML = new DOMParser().parseFromString(responseText, 'text/html')\n\t\t\t\tthis.productElement = qsRequired(\n\t\t\t\t\t'section[id^=\"MainProduct-\"]',\n\t\t\t\t\tresponseHTML.documentElement\n\t\t\t\t)\n\t\t\t\tthis.preventDuplicatedIDs()\n\t\t\t\tthis.removeDOMElements()\n\t\t\t\tthis.setInnerHTML(this.modalContent, this.productElement.innerHTML)\n\n\t\t\t\tif (window.Shopify && window.Shopify.PaymentButton) {\n\t\t\t\t\twindow.Shopify.PaymentButton.init()\n\t\t\t\t}\n\n\t\t\t\tif (window.ProductModel) window.ProductModel.loadShopifyXR()\n\n\t\t\t\tthis.removeGalleryListSemantic()\n\t\t\t\tthis.updateImageSizes()\n\t\t\t\tthis.preventVariantURLSwitching()\n\t\t\t\tsuper.show(opener)\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\topener.removeAttribute('aria-disabled')\n\t\t\t\topener.classList.remove('loading')\n\t\t\t\tqsRequired('.loading-overlay__spinner', opener).classList.add('hidden')\n\t\t\t})\n\t}\n\n\tsetInnerHTML(element: HTMLElement, html: string) {\n\t\telement.innerHTML = html\n\n\t\t// Reinjects the script tags to allow execution. By default, scripts are disabled when using element.innerHTML.\n\t\telement.querySelectorAll('script').forEach((oldScriptTag: HTMLScriptElement) => {\n\t\t\tif (!oldScriptTag.parentNode)\n\t\t\t\tthrow new Error('oldScriptTag.parentNode is null, cannot replace script')\n\t\t\tconst newScriptTag = document.createElement('script')\n\t\t\tArray.from(oldScriptTag.attributes).forEach((attribute) => {\n\t\t\t\tnewScriptTag.setAttribute(attribute.name, attribute.value)\n\t\t\t})\n\t\t\tnewScriptTag.appendChild(document.createTextNode(oldScriptTag.innerHTML))\n\t\t\toldScriptTag.parentNode.replaceChild(newScriptTag, oldScriptTag)\n\t\t})\n\t}\n\n\tpreventVariantURLSwitching() {\n\t\tconst variantPicker = this.modalContent.querySelector('variant-radios,variant-selects')\n\t\tif (!variantPicker) return\n\n\t\tvariantPicker.setAttribute('data-update-url', 'false')\n\t}\n\n\tremoveDOMElements() {\n\t\tif (!this.productElement)\n\t\t\tthrow new Error('this.removeDOMElements called without this.productElement')\n\t\tqsOptional<PickupAvailability>('pickup-availability', this.productElement)?.remove()\n\t\tqsOptional<ProductModal>('product-modal', this.productElement)?.remove()\n\t\tconst modalDialogs = qsaOptional<ModalDialog>('modal-dialog', this.productElement)\n\t\tif (modalDialogs) {\n\t\t\tmodalDialogs.forEach((modal) => modal.remove())\n\t\t}\n\t}\n\n\tpreventDuplicatedIDs() {\n\t\tif (!this.productElement)\n\t\t\tthrow new Error('this.preventDuplicatedIDs called without this.productElement')\n\t\tconst sectionId = getAttributeOrThrow('data-section', this.productElement)\n\t\tthis.productElement.innerHTML = replaceAll(\n\t\t\tthis.productElement.innerHTML,\n\t\t\tsectionId,\n\t\t\t`quickadd-${sectionId}`\n\t\t)\n\t\tconst formComponents = qsaOptional<VariantSelects | VariantRadios | ProductInfo>(\n\t\t\t'variant-selects, variant-radios, product-info',\n\t\t\tthis.productElement\n\t\t)\n\t\tformComponents?.forEach((element) => {\n\t\t\telement.dataset.originalSection = sectionId\n\t\t})\n\t}\n\n\tremoveGalleryListSemantic() {\n\t\tconst galleryList = this.modalContent.querySelector('[id^=\"Slider-Gallery\"]')\n\t\tif (!galleryList) return\n\n\t\tgalleryList.setAttribute('role', 'presentation')\n\t\tgalleryList\n\t\t\t.querySelectorAll('[id^=\"Slide-\"]')\n\t\t\t.forEach((li) => li.setAttribute('role', 'presentation'))\n\t}\n\n\tupdateImageSizes() {\n\t\tconst product = qsRequired('.product', this.modalContent)\n\t\tconst desktopColumns = product.classList.contains('product--columns')\n\t\tif (!desktopColumns) return\n\n\t\tconst mediaImages = qsaOptional<HTMLImageElement>('.product__media img', product)\n\t\tif (!mediaImages) return\n\n\t\tlet mediaImageSizes =\n\t\t\t'(min-width: 1000px) 715px, (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)'\n\n\t\tif (product.classList.contains('product--medium')) {\n\t\t\tmediaImageSizes = mediaImageSizes.replace('715px', '605px')\n\t\t} else if (product.classList.contains('product--small')) {\n\t\t\tmediaImageSizes = mediaImageSizes.replace('715px', '495px')\n\t\t}\n\n\t\tmediaImages.forEach((img: HTMLImageElement) => img.setAttribute('sizes', mediaImageSizes))\n\t}\n}\n","import {QuickAddModal} from '@/scripts/optional/quick-add';\nimport {safeDefineElement} from '@/scripts/functions';\nimport { ProductForm } from '@/scripts/product/product-form';\nsafeDefineElement(QuickAddModal);\nsafeDefineElement(ProductForm)\n"],"names":["QuickAddModal","ModalDialog","qsRequired","preventFocus","cartNotification","qsOptional","opener","getAttributeOrThrow","response","responseText","responseHTML","element","html","oldScriptTag","newScriptTag","attribute","variantPicker","_a","_b","modalDialogs","qsaOptional","modal","sectionId","replaceAll","formComponents","galleryList","li","product","mediaImages","mediaImageSizes","img","safeDefineElement","ProductForm"],"mappings":"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"}