import{q as d,d as C,a as u,o as T,e as A,i as F,j as S,h as D,g as f,k as b,c as w,b as x,t as y,s as p}from"./functions-24c9f5aa.js";import{i as h}from"./animations-be76da08.js";import{U as g}from"./UcoastEl-260a5367.js";import{S as H}from"./search-form-ff968a92.js";const i=class extends g{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=C(e=>{this.onSubmitHandler(e)},500),this.facetForm=d("form",this),this.facetForm.addEventListener("input",this.debouncedOnSubmit.bind(this));const r=u("#FacetsWrapperDesktop",this);r&&r.addEventListener("keyup",T)}static setListeners(){const r=e=>{const t=e.state?e.state.searchParams:i.searchParamsInitial;t!==i.searchParamsPrev&&i.renderPage(t,null,!1)};window.addEventListener("popstate",r)}static toggleActiveFacets(r=!0){document.querySelectorAll(".js-facet-remove").forEach(e=>{e.classList.toggle("disabled",r)})}static renderPage(r,e=null,t=!0){i.searchParamsPrev=r;const n=i.getSections(),s=document.getElementById("ProductCount"),o=document.getElementById("ProductCountDesktop");d(".collection",i.getProductGridContainer()).classList.add("loading"),s&&s.classList.add("loading"),o&&o.classList.add("loading"),n.forEach(l=>{const m=`${window.location.pathname}?section_id=${l.section}&${r}`,E=M=>M.url===m;i.filterData.some(E)?i.renderSectionFromCache(E,e):i.renderSectionFromFetch(m,e)}),t&&i.updateURLHash(r)}static renderSectionFromFetch(r,e){fetch(r).then(t=>t.text()).then(t=>{const n=t,s=new DOMParser().parseFromString(n,"text/html");i.filterData=[...i.filterData,{html:n,url:r}],i.renderFilters(n,e),i.renderProductGridContainer(n),i.renderProductCount(n),typeof h=="function"&&h(s.documentElement)})}static renderSectionFromCache(r,e){var s;const t=(s=i.filterData.find(r))==null?void 0:s.html;if(!t)throw new Error("search filter not found in cache");const n=new DOMParser().parseFromString(t,"text/html");i.renderFilters(t,e),i.renderProductGridContainer(t),i.renderProductCount(t),typeof h=="function"&&h(n.documentElement)}static renderProductGridContainer(r){var s;const e=i.getProductGridContainer(),t=(s=new DOMParser().parseFromString(r,"text/html").getElementById("ProductGridContainer"))==null?void 0:s.innerHTML;t&&(e.innerHTML=t);const n=A(".scroll-trigger",e);n&&n.forEach(o=>{o.classList.add("scroll-trigger--cancel")})}static renderProductCount(r){const e=new DOMParser().parseFromString(r,"text/html"),t=d("#ProductCount",e.documentElement).innerHTML,n=d("#ProductCount"),s=u("#ProductCountDesktop");n.innerHTML=t,n.classList.remove("loading"),s&&(s.innerHTML=t,s.classList.remove("loading"))}static renderFilters(r,e){const t=new DOMParser().parseFromString(r,"text/html"),n=F("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter",t),s=l=>{if(!e)return!1;const m=b(e,".js-filter");return m?l.dataset.index===m.dataset.index:!1},o=Array.from(n).filter(l=>!s(l)),a=Array.from(n).find(s);if(o.forEach(l=>{const m=d(`.js-filter[data-index="${l.dataset.index}"]`);m.innerHTML=l.innerHTML}),i.renderActiveFacets(t),i.renderAdditionalElements(t),a&&e){const l=S(e,".js-filter");i.renderCounts(a,l)}}static renderActiveFacets(r){[".active-facets-mobile",".active-facets-desktop"].forEach(t=>{const n=r.querySelector(t);if(!n)return;const s=d(t);s.innerHTML=n.innerHTML}),i.toggleActiveFacets(!1)}static renderAdditionalElements(r){[".mobile-facets__open",".mobile-facets__count",".sorting"].forEach(s=>{const o=u(s,r),a=u(s);!o||!a||(a.innerHTML=o.innerHTML)});const t=d("#FacetFiltersFormMobile"),n=D(t,"menu-drawer");if(!n)throw new Error("menu-drawer not found, cant close mobile facets");n.bindEvents()}static renderCounts(r,e){const t=u(".facets__selected",e),n=u(".facets__selected",r),s=u(".facets__summary",e),o=u(".facets__summary",r);n&&t&&(t.outerHTML=n.outerHTML),s&&o&&(s.outerHTML=o.outerHTML)}static updateURLHash(r){history.pushState({searchParams:r},"",`${window.location.pathname}${r&&"?".concat(r)}`)}static getSections(){const r=d("#product-grid");return[{section:f("data-id",r)}]}createSearchParams(r){const e=new FormData(r);return new URLSearchParams(e.toString()).toString()}onSubmitForm(r,e){i.renderPage(r,e)}onSubmitHandler(r){var n;r.preventDefault();const e=F("facet-filters-form form"),t=r.srcElement?r.srcElement:void 0;if(t&&t.className=="mobile-facets__checkbox"){const s=S(r,"form"),o=this.createSearchParams(s);this.onSubmitForm(o,r)}else{const s=[],o=((n=b(r,"form"))==null?void 0:n.id)==="FacetFiltersFormMobile";e.forEach(a=>{o?a.id==="FacetFiltersFormMobile"&&s.push(this.createSearchParams(a)):(a.id==="FacetSortForm"||a.id==="FacetFiltersForm"||a.id==="FacetSortDrawerForm")&&(document.querySelectorAll(".no-js-list").forEach(m=>m.remove()),s.push(this.createSearchParams(a)))}),this.onSubmitForm(s.join("&"),r)}}onActiveFilterClick(r){r.preventDefault(),i.toggleActiveFacets();const e=w(r);if(!(e instanceof HTMLAnchorElement))throw new Error("currentTarget is not anchor element");const t=e.href.indexOf("?")==-1?"":e.href.slice(e.href.indexOf("?")+1);i.renderPage(t)}};let c=i;c.htmlSelector="facet-filters-form";c.filterData=[];c.searchParamsInitial=window.location.search.slice(1);c.searchParamsPrev=window.location.search.slice(1);c.searchPathInitial=window.location.pathname;c.searchPathPrev=window.location.pathname;c.getProductGridContainer=()=>d("#ProductGridContainer");function I(){c.filterData=[],c.searchParamsInitial=window.location.search.slice(1),c.searchParamsPrev=window.location.search.slice(1),customElements.define("facet-filters-form",c),c.setListeners()}class P extends g{constructor(){super(),this.querySelectorAll("input").forEach(e=>e.addEventListener("change",this.onRangeChange.bind(this))),this.setMinAndMaxValues()}onRangeChange(e){const t=w(e);this.adjustToValidValues(t),this.setMinAndMaxValues()}setMinAndMaxValues(){const e=this.querySelectorAll("input"),t=e[0],n=e[1];n.value&&t.setAttribute("max",n.value),t.value&&n.setAttribute("min",t.value),t.value===""&&n.setAttribute("min","0"),n.value===""&&t.setAttribute("max",f("max",n))}adjustToValidValues(e){const t=Number(e.value),n=Number(f("min",e)),s=Number(f("max",e));t<n&&(e.value=`${n}`),t>s&&(e.value=`${s}`)}}P.htmlSelector="price-range";class L extends g{constructor(){super();const e=d("a",this);e.setAttribute("role","button"),e.addEventListener("click",this.closeFilter.bind(this)),e.addEventListener("keyup",t=>{t.preventDefault(),t.code.toUpperCase()==="SPACE"&&this.closeFilter(t)})}closeFilter(e){e.preventDefault(),(x(this,"facet-filters-form")||d("facet-filters-form")).onActiveFilterClick(e)}}L.htmlSelector="facet-remove";class v extends H{constructor(){super(),this.allSearchInputs=F('input[type="search"]'),this.setupEventListeners()}setupEventListeners(){let e=[];this.allSearchInputs.forEach(t=>{if(t.form)e.push(t.form);else throw new Error("input in allSearchInputs is not in a form element")}),this.input.addEventListener("focus",this.onInputFocus.bind(this)),!(e.length<2)&&(e.forEach(t=>t.addEventListener("reset",this.onFormReset.bind(this))),this.allSearchInputs.forEach(t=>t.addEventListener("input",this.onInput.bind(this))))}onFormReset(e){super.onFormReset(e),super.shouldResetForm()&&this.keepInSync("",this.input)}onInput(e){const t=y(e);this.keepInSync(t.value,t)}onInputFocus(){window.innerWidth<750&&this.scrollIntoView({behavior:"smooth"})}keepInSync(e,t){this.allSearchInputs.forEach(n=>{n!==t&&(n.value=e)})}}v.htmlSelector="main-search";p(c,void 0,I);p(P);p(L);p(v);
//# sourceMappingURL=js-dir-catalog-cb89e598.js.map
