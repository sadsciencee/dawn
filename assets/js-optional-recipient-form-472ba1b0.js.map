{"version":3,"file":"js-optional-recipient-form-472ba1b0.js","sources":["../src/scripts/optional/recipient-form.ts","../src/entry/js-optional-recipient-form.ts"],"sourcesContent":["import { PUB_SUB_EVENTS } from '@/scripts/theme/constants'\nimport {\n\tisCartErrorEvent,\n\tisCartUpdateEvent,\n\tisVariantChangeEvent,\n\tsubscribe,\n} from '@/scripts/theme/pubsub'\nimport { getAttributeOrThrow, qsaOptional, qsOptional, qsRequired } from '@/scripts/functions';\nimport { type uCoastWindow } from '@/scripts/setup'\nimport { UcoastEl } from '@/scripts/core/UcoastEl';\n\ndeclare let window: uCoastWindow\n\nexport class RecipientForm extends UcoastEl {\n\tstatic htmlSelector = 'recipient-form'\n\tsectionId: string\n\trecipientFieldsLiveRegion: HTMLElement\n\tcheckboxInput: HTMLInputElement\n\thiddenControlField: HTMLInputElement\n\temailInput: HTMLInputElement\n\tnameInput: HTMLInputElement\n\tmessageInput: HTMLInputElement\n\tsendonInput: HTMLInputElement\n\toffsetProperty?: HTMLInputElement\n\terrorMessageWrapper?: HTMLElement\n\terrorMessageList?: HTMLElement\n\terrorMessage?: HTMLElement\n\tcurrentProductVariantId: string\n\tdefaultErrorHeader?: string\n\t// from native dawn constructor\n\tcartUpdateUnsubscriber?: () => void = undefined\n\tvariantChangeUnsubscriber?: () => void = undefined\n\tcartErrorUnsubscriber?: () => void = undefined\n\tconstructor() {\n\t\tsuper()\n\t\tconst sectionId = this.dataset.sectionId\n\t\tif (!sectionId) throw new Error('RecipientForm: missing data-section-id')\n\t\tthis.sectionId = sectionId\n\t\tthis.recipientFieldsLiveRegion = qsRequired(\n\t\t\t`#Recipient-fields-live-region-${this.sectionId}`,\n\t\t\tthis\n\t\t)\n\t\tthis.checkboxInput = qsRequired(`#Recipient-checkbox-${this.sectionId}`, this)\n\t\tthis.checkboxInput.disabled = false\n\t\tthis.hiddenControlField = qsRequired(`#Recipient-control-${this.sectionId}`, this)\n\t\tthis.hiddenControlField.disabled = true\n\t\tthis.emailInput = qsRequired(`#Recipient-email-${this.sectionId}`, this)\n\t\tthis.nameInput = qsRequired(`#Recipient-name-${this.sectionId}`, this)\n\t\tthis.messageInput = qsRequired(`#Recipient-message-${this.sectionId}`, this)\n\t\tthis.sendonInput = qsRequired(`#Recipient-send-on-${this.sectionId}`, this)\n\t\tthis.offsetProperty = qsOptional(`#Recipient-timezone-offset-${this.sectionId}`, this)\n\t\tif (this.offsetProperty)\n\t\t\tthis.offsetProperty.value = new Date().getTimezoneOffset().toString()\n\n\t\tthis.errorMessageWrapper = qsOptional('.product-form__recipient-error-message-wrapper')\n\t\tif (this.errorMessageWrapper instanceof HTMLElement) {\n\t\t\tthis.errorMessageList = qsRequired('ul', this.errorMessageWrapper)\n\t\t\tthis.errorMessage = qsRequired('.error-message', this.errorMessageWrapper)\n\t\t\tthis.defaultErrorHeader = this.errorMessage.innerText\n\t\t} else {\n\t\t\tconsole.warn('RecipientForm: missing error message wrapper')\n\t\t}\n\t\tthis.currentProductVariantId = getAttributeOrThrow('product-variant-id', this)\n\t\tthis.addEventListener('change', this.onChange.bind(this))\n\t\tthis.onChange()\n\t}\n\n\toverride connectedCallback() {\n\t\tthis.cartUpdateUnsubscriber = subscribe(PUB_SUB_EVENTS.cartUpdate, (event) => {\n\t\t\tif (!isCartUpdateEvent(event)) return\n\t\t\tif (\n\t\t\t\tevent &&\n\t\t\t\tevent.source === 'product-form' &&\n\t\t\t\tevent.productVariantId?.toString() === this.currentProductVariantId\n\t\t\t) {\n\t\t\t\tthis.resetRecipientForm()\n\t\t\t}\n\t\t})\n\n\t\tthis.variantChangeUnsubscriber = subscribe(PUB_SUB_EVENTS.variantChange, (event) => {\n\t\t\tif (!isVariantChangeEvent(event)) return\n\t\t\tif (event && event.data && event.data.sectionId === this.sectionId) {\n\t\t\t\tthis.currentProductVariantId = event.data.variant.id.toString()\n\t\t\t}\n\t\t})\n\n\t\tthis.cartUpdateUnsubscriber = subscribe(PUB_SUB_EVENTS.cartError, (event) => {\n\t\t\tif (!isCartErrorEvent(event)) return\n\t\t\tif (\n\t\t\t\tevent.source === 'product-form' &&\n\t\t\t\tevent.productVariantId.toString() === this.currentProductVariantId\n\t\t\t) {\n\t\t\t\tthis.displayErrorMessage(event.message, event.errors)\n\t\t\t}\n\t\t})\n\t}\n\n\toverride disconnectedCallback() {\n\t\tif (this.cartUpdateUnsubscriber) {\n\t\t\tthis.cartUpdateUnsubscriber()\n\t\t}\n\n\t\tif (this.variantChangeUnsubscriber) {\n\t\t\tthis.variantChangeUnsubscriber()\n\t\t}\n\n\t\tif (this.cartErrorUnsubscriber) {\n\t\t\tthis.cartErrorUnsubscriber()\n\t\t}\n\t}\n\n\tonChange() {\n\t\tif (this.checkboxInput.checked) {\n\t\t\tthis.enableInputFields()\n\t\t\tthis.recipientFieldsLiveRegion.innerText =\n\t\t\t\twindow.accessibilityStrings.recipientFormExpanded\n\t\t} else {\n\t\t\tthis.clearInputFields()\n\t\t\tthis.disableInputFields()\n\t\t\tthis.clearErrorMessage()\n\t\t\tthis.recipientFieldsLiveRegion.innerText =\n\t\t\t\twindow.accessibilityStrings.recipientFormCollapsed\n\t\t}\n\t}\n\n\tinputFields(): HTMLInputElement[] {\n\t\treturn [this.emailInput, this.nameInput, this.messageInput, this.sendonInput]\n\t}\n\n\tdisableableFields(): HTMLInputElement[] {\n\t\treturn this.offsetProperty\n\t\t\t? [...this.inputFields(), this.offsetProperty]\n\t\t\t: this.inputFields()\n\t}\n\n\tclearInputFields() {\n\t\tthis.inputFields().forEach((field) => (field.value = ''))\n\t}\n\n\tenableInputFields() {\n\t\tthis.disableableFields().forEach((field) => (field.disabled = false))\n\t}\n\n\tdisableInputFields() {\n\t\tthis.disableableFields().forEach((field) => (field.disabled = true))\n\t}\n\n\tdisplayErrorMessage(_title: string, body: string | string[] | { [key: string]: string[] }) {\n\t\tthis.clearErrorMessage()\n\t\tif (!this.errorMessageWrapper)\n\t\t\tthrow new Error(\n\t\t\t\t'RecipientForm: displayErrorMessage called too early, missing error message wrapper'\n\t\t\t)\n\t\tthis.errorMessageWrapper.hidden = false\n\t\tif (typeof body === 'object') {\n\t\t\tif (!(this.errorMessage instanceof HTMLElement))\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'RecipientForm: displayErrorMessage called too early, missing error message'\n\t\t\t\t)\n\t\t\tthis.errorMessage.innerText = this.defaultErrorHeader ?? 'Error'\n\t\t\treturn Object.entries(body).forEach(([key, value]) => {\n\t\t\t\tconst errorMessageId = `RecipientForm-${key}-error-${this.sectionId}`\n\t\t\t\tconst fieldSelector = `#Recipient-${key}-${this.sectionId}`\n\t\t\t\tconst message = `${value.join(', ')}`\n\t\t\t\tconst errorMessageElement = qsRequired(`#${errorMessageId}`, this)\n\t\t\t\tconst errorTextElement = qsRequired('.error-message', errorMessageElement)\n\n\t\t\t\tif (this.errorMessageList) {\n\t\t\t\t\tthis.errorMessageList.appendChild(\n\t\t\t\t\t\tthis.createErrorListItem(fieldSelector, message)\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\terrorTextElement.innerText = `${message}.`\n\t\t\t\terrorMessageElement.classList.remove('hidden')\n\n\t\t\t\tconst inputElement = this.getInputElement(key)\n\t\t\t\tif (!inputElement) return\n\n\t\t\t\tinputElement.setAttribute('aria-invalid', 'true')\n\t\t\t\tinputElement.setAttribute('aria-describedby', errorMessageId)\n\t\t\t})\n\t\t}\n\n\t\tif (!(this.errorMessage instanceof HTMLElement))\n\t\t\tthrow new Error('Missing this.errorMessage, cannot display error')\n\t\tthis.errorMessage.innerText = body\n\t}\n\n\tgetInputElement(key: string): HTMLInputElement {\n\t\tswitch (key) {\n\t\t\tcase 'email':\n\t\t\t\treturn this.emailInput\n\t\t\tcase 'name':\n\t\t\t\treturn this.nameInput\n\t\t\tcase 'message':\n\t\t\t\treturn this.messageInput\n\t\t\tcase 'sendon':\n\t\t\t\treturn this.sendonInput\n\t\t\tcase 'checkbox':\n\t\t\t\treturn this.checkboxInput\n\t\t}\n\t\tthrow new Error(`RecipientForm: unknown input element ${key}`)\n\t}\n\n\tcreateErrorListItem(target:string, message:string) {\n\t\tconst li = document.createElement('li')\n\t\tconst a = document.createElement('a')\n\t\ta.setAttribute('href', target)\n\t\ta.innerText = message\n\t\tli.appendChild(a)\n\t\tli.className = 'error-message'\n\t\treturn li\n\t}\n\n\tclearErrorMessage() {\n\t\tif (!this.errorMessageWrapper) throw new Error('Missing this.errorMessageWrapper, cannot clearErrorMessage')\n\t\tthis.errorMessageWrapper.hidden = true\n\n\t\tif (this.errorMessageList) this.errorMessageList.innerHTML = ''\n\n\t\tconst errorMessages = qsaOptional('.recipient-fields .form__message', this)\n\t\tif (errorMessages) {\n\t\t\terrorMessages.forEach((field) => {\n\t\t\t\tfield.classList.add('hidden')\n\t\t\t\tconst textField = qsOptional('.error-message', field)\n\t\t\t\tif (textField) textField.innerText = ''\n\t\t\t})\n\t\t}\n\n\n\t\t;[this.emailInput, this.messageInput, this.nameInput, this.sendonInput].forEach(\n\t\t\t(inputElement) => {\n\t\t\t\tinputElement.setAttribute('aria-invalid', 'false')\n\t\t\t\tinputElement.removeAttribute('aria-describedby')\n\t\t\t}\n\t\t)\n\t}\n\n\tresetRecipientForm() {\n\t\tif (this.checkboxInput.checked) {\n\t\t\tthis.checkboxInput.checked = false\n\t\t\tthis.clearInputFields()\n\t\t\tthis.clearErrorMessage()\n\t\t}\n\t}\n}\n","import {RecipientForm} from '@/scripts/optional/recipient-form';\nimport {safeDefineElement} from '@/scripts/functions';\nsafeDefineElement(RecipientForm);\n"],"names":["RecipientForm","UcoastEl","sectionId","qsRequired","qsOptional","getAttributeOrThrow","subscribe","PUB_SUB_EVENTS","event","isCartUpdateEvent","_a","isVariantChangeEvent","isCartErrorEvent","field","_title","body","key","value","errorMessageId","fieldSelector","message","errorMessageElement","errorTextElement","inputElement","target","li","a","errorMessages","qsaOptional","textField","safeDefineElement"],"mappings":"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"}